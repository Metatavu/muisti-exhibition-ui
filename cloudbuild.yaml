steps:
- name: 'gcr.io/cloud-builders/git'
  entrypoint: 'bash'
  args:
    - '-c'
    - |
      git init
      git remote add origin https://github.com/Metatavu/muisti-exhibition-ui.git
      git fetch --depth=1 origin $COMMIT_SHA
      git reset --hard FETCH_HEAD
      git submodule update --init
- name: gcr.io/$PROJECT_ID/remote-builder
  env:
    - USERNAME=root
    - ZONE=us-central1-b
    - COMMAND=cd workspace && JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-amd64 ANDROID_SDK_ROOT=/usr/lib/android-sdk ./gradlew clean test
    - INSTANCE_ARGS=--image=android-build-rev3 --machine-type n1-standard-4 --image-project=$PROJECT_ID
timeout: 6001s
